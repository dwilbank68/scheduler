<% if @unituser.destroyed? %>
    $('#unit_user_' + <%= @unituser.id %>).fadeOut();

    var $unit = $('#unit_' + <%= params[:unit_id] %>);
    var duration = <%= JSON.parse(@response)['data']['duration'] %>;
    var unit_available = '<%= JSON.parse(@response)['data']['time_available'] %>'.replace(/&quot;/g,'"').replace(/&gt;/g,'>');
    var unit_available_string = moment(unit_available).format('MMM D, hh:mm A');
    var uu_queue = '<%= JSON.parse(@response)['data']['uu_queue'] %>'.replace(/&quot;/g,'"').replace(/&gt;/g,'').replace(/=/g,':');
    var uu_queue_arr = JSON.parse(uu_queue);
    var unit_arr = '<%= JSON.parse(@response)['unit_arr'] %>'.replace(/&quot;/g,'"').replace(/&gt;/g,'').replace(/=/g,':');
    var unit_arr_arr = JSON.parse(unit_arr);

    if(duration > 0) {
        $unit.find('.est-time-of-completion').html(unit_available_string);
    } else {
        $unit.find('.est-time-of-completion').html("Unit Available");
    }

    // update start and end times for the whole queue
    for(var i=0; i<uu_queue_arr.length; i++) {
        $('#start_time_' +uu_queue_arr[i]['id']).html(uu_queue_arr[i]['start_time_formatted']);
        $('#end_time_'   +uu_queue_arr[i]['id']).html(uu_queue_arr[i]['end_time_formatted']);
    }

    // wipe out old unit countdown and then
    $('#unit_' + <%= params[:unit_id] %>).find($('.time-remaining')).countdown('destroy');

    // update all unit countdowns
    for(var i=0; i<unit_arr_arr.length; i++) {
        var id = unit_arr_arr[i]['id'];
        var endTime = unit_arr_arr[i]['time_available'];
        if(endTime === "") {
            $('#unit_' + id).find($('.time-remaining')).html("--:--:--");
        } else {
            var endTimeMoment = moment(endTime);
            $('#unit_' + id).find($('.time-remaining')).countdown({ until: endTimeMoment.toDate(), compact: true });
        }
    }



<% end %>